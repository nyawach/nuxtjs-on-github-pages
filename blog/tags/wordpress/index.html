<!doctype html>
<html data-n-head-ssr lang="ja" data-n-head="lang">
  <head>
    <title data-n-head="true">WordPress | hyme</title><meta data-n-head="true" name="fragment" content="!"><meta data-n-head="true" data-hid="charset" charset="utf-8"><meta data-n-head="true" data-hid="viewport" name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta data-n-head="true" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="true" data-hid="apple-mobile-web-app-title" name="apple-mobile-web-app-title" content="hyme"><meta data-n-head="true" data-hid="author" name="author" content="hyme"><meta data-n-head="true" data-hid="description" name="description" content="Webエンジニアの自己紹介サイトです。"><meta data-n-head="true" data-hid="theme-color" name="theme-color" content="#111"><meta data-n-head="true" data-hid="og:type" name="og:type" property="og:type" content="website"><meta data-n-head="true" data-hid="og:title" name="og:title" property="og:title" content="hyme"><meta data-n-head="true" data-hid="og:site_name" name="og:site_name" property="og:site_name" content="hyme"><meta data-n-head="true" data-hid="og:description" name="og:description" property="og:description" content="Webエンジニアの自己紹介サイトです。"><meta data-n-head="true" data-hid="twitter:card" name="twitter:card" property="twitter:card" content="summary_large_image"><meta data-n-head="true" data-hid="twitter:site" name="twitter:site" property="twitter:site" content="@_hyme_"><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="true" rel="icon" type="image/png" sizes="192x192" href="/icon192.png"><link data-n-head="true" rel="apple-touch-icon" sizes="180x180" href="/icon192.png"><link data-n-head="true" rel="manifest" href="/nuxtjs-on-github-pages/_nuxt/manifest.f3f129f8.json"><link data-n-head="true" rel="shortcut icon" href="icon180.png"><script data-n-head="true" src="//www.googletagmanager.com/gtm.js?id=GTM-N72GKLM&l=dataLayer" async></script><base href="/nuxtjs-on-github-pages/"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/1d77e36bfaf4096e9780.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/3f4eac2dce17f6d01105.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/be114672403339f61f60.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/59b2d8ea80011bfd3679.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/cfc4fa4f73bd9b28d00c.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/b393d0689b9c4ca582b8.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/ca2abb884837f33d058f.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/e2933058242d1d7a0ae8.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/64f66d2878d032261053.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/f8599319a527aafa5ebe.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/6eb7bfc61b02947e81fb.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/c38fbb699c8ff3f12853.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/f7125c16520a272d86f8.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/e57654431899a8469e5c.js" as="script"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/be114672403339f61f60.css"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/cfc4fa4f73bd9b28d00c.css"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/ca2abb884837f33d058f.css"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/64f66d2878d032261053.css"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/6eb7bfc61b02947e81fb.css"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/f7125c16520a272d86f8.css">
    <script>window.prerenderReady=!1</script>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><main class="blog" data-v-a5efaa08><header data-v-75930c71 data-v-a5efaa08><div class="logo" data-v-75930c71><a href="/nuxtjs-on-github-pages/" class="logo__link nuxt-link-active" data-v-75930c71>hyme</a></div><div class="lead" data-v-75930c71>ちょっとなにかある。</div></header><div class="title-box" data-v-a5efaa08><h1 class="title" data-v-a5efaa08>WordPress</h1></div><div class="content" data-v-4fb14097 data-v-a5efaa08><ul class="posts" data-v-4fb14097><li class="post-item" data-v-cc1e1478 data-v-4fb14097><a href="/nuxtjs-on-github-pages/blog/posts/smart-custom-field/" data-v-cc1e1478><div class="info" data-v-cc1e1478><span class="info__category" data-v-cc1e1478>Web</span><time class="info__created-at" data-v-cc1e1478>2018.06.09</time></div><p class="title" data-v-cc1e1478>Smart Custom Fieldを使ってカスタムフィールドを追加する</p></a></li></ul></div><footer class="footer" data-v-6241211e data-v-a5efaa08><div class="inner" data-v-6241211e><small class="copy" data-v-6241211e>© 2018-2019 hyme</small></div></footer></main></div></div><script>window.__NUXT__=function(n,e,t,s,i,a,p,r,o,d,l,y,m,g,u){return o.sys={space:{sys:{type:n,linkType:s,id:t}},id:"1RHECfKcNO0OaW280uCOCY",type:r,createdAt:"2018-06-09T13:05:20.243Z",updatedAt:"2018-06-09T13:05:58.402Z",environment:{sys:{id:i,type:n,linkType:a}},revision:2,contentType:{sys:{type:n,linkType:p,id:"category"}},locale:e},o.fields={name:"Web",slug:"web"},{layout:"default",data:[{posts:[{sys:{space:{sys:{type:n,linkType:s,id:t}},id:"6id0y41YZi4uUw8W2W6iqE",type:r,createdAt:"2018-06-09T13:20:14.372Z",updatedAt:"2019-02-15T15:15:51.574Z",environment:{sys:{id:i,type:n,linkType:a}},revision:6,contentType:{sys:{type:n,linkType:p,id:"blog"}},locale:e},fields:{title:"Smart Custom Fieldを使ってカスタムフィールドを追加する",slug:"smart-custom-field",category:o,tag:[{sys:{space:{sys:{type:n,linkType:s,id:t}},id:d,type:r,createdAt:l,updatedAt:l,environment:{sys:{id:i,type:n,linkType:a}},revision:1,contentType:{sys:{type:n,linkType:p,id:"tag"}},locale:e},fields:{name:m,slug:g,category:o}}],description:"WordPressの案件で必ずつきまとうのが、カスタムフィールド管理について。今回は、カスタムフィールドの設定をコードとして保存できるSmart Custom Field(SCF)についてと、カスタムフィールドを追加する手順についての記事です。",thumbnail:{sys:{space:{sys:{type:n,linkType:s,id:t}},id:"4dT569vDufOkU3uGQSoVCH",type:"Asset",createdAt:u,updatedAt:u,environment:{sys:{id:i,type:n,linkType:a}},revision:1,locale:e},fields:{title:"scf",file:{url:"//images.ctfassets.net/xisblufoxlb6/4dT569vDufOkU3uGQSoVCH/49e49bdff3326eaed486e1d813e7d0ac/banner-1544x500.png",details:{size:129696,image:{width:1544,height:500}},fileName:"banner-1544x500.png",contentType:"image/png"}}},body:"WordPressの案件で必ずつきまとうのが、カスタムフィールド管理について。\n今回は、カスタムフィールドの設定をコードとして保存できるSmart Custom Field(SCF)についてと、カスタムフィールドを追加する手順についての記事です。\n\n## Smart Custom Fieldについて\n\nカスタムフィールドをコードベースで設定できる WordPressプラグインです。\nDBに保存する必要があるカスタムフィールドの設定項目ですが、このプラグインを使うことで `.php` ファイルで管理することができます。\n基本的なループやラジオボタンなどは対応しています。(関連付けなどはなかったかも)\n開発者が日本の方だそう。\n\n## Smart Custom Fieldを使うメリット\n\n\n### Git管理ができる\n\nこれに尽きると思います。\nまた、バージョン管理せずに他のプラグインのように管理画面から設定することも可能です。\nただし、そちらで設定した項目はDBに保存されるため、バージョン管理の項目から外れてしまいます。\n\n\n### ループに対応\n\nグループごとにループの設定ができます。\nまた、デフォルトではないループで設定した値をグルーピングして取得するための機能(`SCF::get('group-name')`)が用意されています。\n\n\n今回は、ラーメンを投稿するブログサイトを作る場合に、以下のような項目を入力してもらう想定でカスタムフィールドを指定しましょう。\n\n\n\n## Smart Custom Fieldをインストール&有効化\n\n管理画面などからプラグインを検索してインストールしましょう。\n\nターミナルからなら、WP-CLIでインストールできると楽ですね。\n\n`wp plugin install custom-post-type-permalinks --activate`\n\n\n\n## 実際にコードを書く\n\n今回は、`post` 投稿タイプにのみ表示されるカスタムフィールドを作成します。\n\n\n### function.phpにカスタムフィールドの項目を追加する関数を書く\n\n```php\nfunction add_shop_info_fields($settings, $post_type, $post_id, $meta_type) {\n  // post以外の投稿タイプなら特に何もしない\n  if($post_type != 'post') return $settings;\n\n  // 引数: (設定名スラッグ, ラベル名)\n  $Setting = SCF::add_setting('shop-info', '店舗情報');\n\n  $items = array(\n    array(\n      'name'  => 'name',\n      'label' => '店舗名',\n      'type'  => 'text'\n    ),\n    array(\n      'name' => 'place',\n      'label' => '住所',\n      'type' => 'textarea',\n    ),\n    array(\n      'name' => 'description',\n      'label' => '店舗の説明',\n      'type' => 'textarea',\n    ),\n    array(\n      'name' => 'image',\n      'label' => '店舗の画像',\n      'type' => 'image',\n    ),\n  );\n\n  // 引数: (グループ名, ループの可否, 項目の配列)\n  $Setting->add_group('group-shop-info', true, $items);\n\n  // 今あるカスタムフィールドの設定に$Settingを追加\n  array_push($settings, $Setting);\n\n  return $settings;\n}\n\n// smart-cf-register-fieldsにフック\nadd_filter('smart-cf-register-fields', 'add_shop_info_fields', 10, 4);\n```\n\nこれを保存して新規投稿画面に移動すると、下の方にカスタムフィールドが表示されていると思います。\n\n![画像]\n\n\n### 該当ページに設定した情報を表示させる\n\n基本的には、メインループ内で `SCF::get('meta_data')` で取得することができます。\n\n```\n<?php\n  $info_array = SCF::get('group-shop-info');\n  foreach($info_array as $info):\n?>\n  <?php if(isset($info['name']): ?>\n    <p><?=$info['name'] ?></p>\n  <?php endif; ?>\n<?php endforeach; ?>\n```\n\n\n### 該当ページ以外でカスタムフィールドの値を取得する場合\n\nたとえば、トップページに店舗名の一覧だけ表示したいという場合には、カスタムフィールドを設定したページのID(固定ページなら固定ページのID、投稿なら記事IDなど)を設定することで取得することができます。\n\n```\n<?php\n// front-page.phpなど\nSCF::get('group-shop-info', get_page_by_path('shop'));\n```\n\n\n\n## SCFを使う時に覚えておくこと\n\n\n### ループの有無で取得方法が変わる\n\n\n### 画像/ファイル/ページなどはすべてIDが保存される\n\nWordPressにアップロードした画像などのファイルや、関連記事などで選択した記事をSCFで設定した場合、すべてIDとして保存される仕組みになっています。\n\n[言及してたURL]()\n\nしたがって、ファイルや記事を取得したい場合は、 `wp_get_attachment()` や `get_the_post()` などにIDを渡して取得する必要があります。\n統一されているのでわかりやすいです。\n\n\n\n## カスタムフィールドの投稿タイプの種類\n\n基本的にWordPressのデフォルトで指定できるものには対応しています。\n\n\n## 参考ページ\n\n- https://github.com/inc2734/smart-custom-fields/\n- https://gist.github.com/inc2734/9f6d65c7473d060d0fd6#file-gistfile1-php-L4\n- https://ja.wordpress.org/plugins/smart-custom-fields/\n- [Smart Custom Fields でカスタムフィールドの定義を Git で管理できるようになりました！ &#8211; モンキーレンチ](https://2inc.org/blog/2015/03/12/4670/)\n- [SmartCustomFieldsのコードでの定義についてのまとめ](http://qiita.com/yousan/items/7cbd56308ecc0e2bb263)\n"}}],tag:{id:d,slug:g,name:m}}],error:null,state:{auth:!1},serverRendered:!0}}("Link","ja-JP","xisblufoxlb6","Space","master","Environment","ContentType","Entry",{},"3s6v1pLEY8eMEM6yosqKwA","2018-06-09T13:07:13.090Z",0,"WordPress","wordpress","2019-02-08T09:06:56.352Z")</script><script src="/nuxtjs-on-github-pages/_nuxt/1d77e36bfaf4096e9780.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/b393d0689b9c4ca582b8.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/e2933058242d1d7a0ae8.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/f8599319a527aafa5ebe.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/c38fbb699c8ff3f12853.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/e57654431899a8469e5c.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/3f4eac2dce17f6d01105.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/59b2d8ea80011bfd3679.js" defer></script>
  </body>
</html>
