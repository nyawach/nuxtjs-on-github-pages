<!doctype html>
<html data-n-head-ssr lang="ja" data-n-head="lang">
  <head>
    <title data-n-head="true">Netlify | hyme</title><meta data-n-head="true" name="fragment" content="!"><meta data-n-head="true" data-hid="charset" charset="utf-8"><meta data-n-head="true" data-hid="viewport" name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta data-n-head="true" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="true" data-hid="apple-mobile-web-app-title" name="apple-mobile-web-app-title" content="hyme"><meta data-n-head="true" data-hid="author" name="author" content="hyme"><meta data-n-head="true" data-hid="description" name="description" content="Webエンジニアの自己紹介サイトです。"><meta data-n-head="true" data-hid="theme-color" name="theme-color" content="#111"><meta data-n-head="true" data-hid="og:type" name="og:type" property="og:type" content="website"><meta data-n-head="true" data-hid="og:title" name="og:title" property="og:title" content="hyme"><meta data-n-head="true" data-hid="og:site_name" name="og:site_name" property="og:site_name" content="hyme"><meta data-n-head="true" data-hid="og:description" name="og:description" property="og:description" content="Webエンジニアの自己紹介サイトです。"><meta data-n-head="true" data-hid="twitter:card" name="twitter:card" property="twitter:card" content="summary_large_image"><meta data-n-head="true" data-hid="twitter:site" name="twitter:site" property="twitter:site" content="@_hyme_"><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="true" rel="icon" type="image/png" sizes="192x192" href="/icon192.png"><link data-n-head="true" rel="apple-touch-icon" sizes="180x180" href="/icon192.png"><link data-n-head="true" rel="manifest" href="/nuxtjs-on-github-pages/_nuxt/manifest.f3f129f8.json"><link data-n-head="true" rel="shortcut icon" href="icon180.png"><script data-n-head="true" src="//www.googletagmanager.com/gtm.js?id=GTM-N72GKLM&l=dataLayer" async></script><base href="/nuxtjs-on-github-pages/"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/1d77e36bfaf4096e9780.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/3f4eac2dce17f6d01105.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/be114672403339f61f60.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/59b2d8ea80011bfd3679.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/cfc4fa4f73bd9b28d00c.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/b393d0689b9c4ca582b8.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/ca2abb884837f33d058f.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/e2933058242d1d7a0ae8.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/64f66d2878d032261053.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/f8599319a527aafa5ebe.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/6eb7bfc61b02947e81fb.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/c38fbb699c8ff3f12853.js" as="script"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/f7125c16520a272d86f8.css" as="style"><link rel="preload" href="/nuxtjs-on-github-pages/_nuxt/e57654431899a8469e5c.js" as="script"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/be114672403339f61f60.css"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/cfc4fa4f73bd9b28d00c.css"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/ca2abb884837f33d058f.css"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/64f66d2878d032261053.css"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/6eb7bfc61b02947e81fb.css"><link rel="stylesheet" href="/nuxtjs-on-github-pages/_nuxt/f7125c16520a272d86f8.css">
    <script>window.prerenderReady=!1</script>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><main class="blog" data-v-a5efaa08><header data-v-75930c71 data-v-a5efaa08><div class="logo" data-v-75930c71><a href="/nuxtjs-on-github-pages/" class="logo__link nuxt-link-active" data-v-75930c71>hyme</a></div><div class="lead" data-v-75930c71>ちょっとなにかある。</div></header><div class="title-box" data-v-a5efaa08><h1 class="title" data-v-a5efaa08>Netlify</h1></div><div class="content" data-v-4fb14097 data-v-a5efaa08><ul class="posts" data-v-4fb14097><li class="post-item" data-v-cc1e1478 data-v-4fb14097><a href="/nuxtjs-on-github-pages/blog/posts/effective-public-flow/" data-v-cc1e1478><div class="info" data-v-cc1e1478><span class="info__category" data-v-cc1e1478>Web</span><time class="info__created-at" data-v-cc1e1478>2018.08.04</time></div><p class="title" data-v-cc1e1478>Netlify Build hooks + Contentful Webhookで記事公開フローを効率化する</p></a></li></ul></div><footer class="footer" data-v-6241211e data-v-a5efaa08><div class="inner" data-v-6241211e><small class="copy" data-v-6241211e>© 2018-2019 hyme</small></div></footer></main></div></div><script>window.__NUXT__=function(e,n,t,s,i,o,l,a,f,y,d,p,c,b,g,u){return f.sys={space:{sys:{type:e,linkType:o,id:n}},id:"1RHECfKcNO0OaW280uCOCY",type:l,createdAt:"2018-06-09T13:05:20.243Z",updatedAt:"2018-06-09T13:05:58.402Z",environment:{sys:{id:t,type:e,linkType:s}},revision:2,contentType:{sys:{type:e,linkType:a,id:"category"}},locale:i},f.fields={name:"Web",slug:"web"},{layout:"default",data:[{posts:[{sys:{space:{sys:{type:e,linkType:o,id:n}},id:"2jOwxadZosK0aWUW6e2E4o",type:l,createdAt:"2018-08-04T03:11:45.178Z",updatedAt:"2018-10-06T19:41:25.816Z",environment:{sys:{id:t,type:e,linkType:s}},revision:4,contentType:{sys:{type:e,linkType:a,id:"blog"}},locale:i},fields:{title:"Netlify Build hooks + Contentful Webhookで記事公開フローを効率化する",slug:"effective-public-flow",category:f,tag:[{sys:{space:{sys:{type:e,linkType:o,id:n}},id:y,type:l,createdAt:d,updatedAt:d,environment:{sys:{id:t,type:e,linkType:s}},revision:1,contentType:{sys:{type:e,linkType:a,id:"tag"}},locale:i},fields:{name:b,slug:g,category:f}},{sys:{space:{sys:{type:e,linkType:o,id:n}},id:"2vNVGoPyswIoyQImmqO2We",type:l,createdAt:u,updatedAt:u,environment:{sys:{id:t,type:e,linkType:s}},revision:1,contentType:{sys:{type:e,linkType:a,id:"tag"}},locale:i},fields:{name:"Contentful",slug:"contentful",category:f}}],description:"ウェブサイトホスティングサービスのNetlifyのBuild hooksと、Headless CMSであるContentfulのWebhookを用いて、このサイトで実際に使っている自動記事公開環境の作成方法について説明します。",thumbnail:{sys:{space:{sys:{type:e,linkType:o,id:n}},id:"nAh3jYSKBwSAOCGsKy6GI",type:"Asset",createdAt:"2018-10-06T17:48:04.050Z",updatedAt:"2018-10-06T19:40:05.744Z",environment:{sys:{id:t,type:e,linkType:s}},revision:3,locale:i},fields:{title:"ogp",file:{url:"//images.ctfassets.net/xisblufoxlb6/nAh3jYSKBwSAOCGsKy6GI/869e027a003a998b9daea5acb1eff4d0/ogp1.png",details:{size:48345,image:{width:1200,height:630}},fileName:"ogp1.png",contentType:"image/png"}}},body:"このサイトは、Contentfulを使って記事の配信、Netlifyでウェブサイトのホスティングを行っており、記事を公開するまでのフローは次のようになっています。\n\n1. 記事を書く\n2. Contentfulの管理画面に入力\n3. 「Publish」ボタンを押して公開(ここまでで筆者の作業は終了)\n4. Netlifyのビルドが実行される\n5. サイトに公開される\n\n上記のように、記事を書く場合はWordPressや通常のブログサイトと同じようなフローで記事を公開できるフローを作っています。\n今回は、この4~6の、「Publishしたら勝手にNetlifyのデプロイを実行する」設定方法について触れようと思います。\n\n## 概要\n\n- NetlifyのContinuous Deployment機能には、Build hooks用のAPIを追加することができる\n- Contentfulには、Content公開時などにWebhookを設定できる\n\nこの両者の機能を使って、前述の4~6のフローを実現しています。\n\n## 設定方法\n\nでは、実際に設定していきます。(NetlifyのDeploy Settingまでの設定と、Contentfulの設定が終わってる前提です。)\n\n### NetlifyのBuild hook用のAPIの作成\n\nまずはNetlifyのBuild hook用のAPIを作成します。  \n用途がわかるような名称(今回は「Webhook for Contentful」としてます)と、ビルドを実行するブランチを指定します。\n\n![1](//images.ctfassets.net/xisblufoxlb6/h0AaILJVsc4w6mK84SEQa/a7c448e60b979fc0ae55478299e3abce/1.png)\n\n「Save」すればAPIのURLが発行されます。\n\n![2](//images.ctfassets.net/xisblufoxlb6/6kMqWKFpm0EiCKKqUgMgaU/5ad76e8716e148bf102fa521b79e3a60/2.png)\n\n### ContentfulのWebhookの設定\n\n次は、 Contentfulの管理画面でWebhookの設定を行います。\n\n管理画面メニューの「Space settings」→「Webhooks」を選択します。  \n次に、右下の「Webhook templates」から「Netlify」を選びます。\n\n![4](//images.ctfassets.net/xisblufoxlb6/2zr7Ez1nqQ4sIas8IosywO/1ac7884bedf3e92bd735f04ec020984b/4.png)\n\nそして、先程Netlify側で設定したBuild hook用のURLを「Netlify build hook URL」に設定します。\n\n![5](//images.ctfassets.net/xisblufoxlb6/fd1KgedLq0S88MWkYKIcm/fd3a24a78b59b612f5073cfda5cf6ab7/5.png)\n\n最後に「Create webhook」をクリックすれば設定完了です。\n以下のようなダイアログと同時に、Netlify用のWebhookが設定された画面に遷移します。\n\n![6](//images.ctfassets.net/xisblufoxlb6/5CX8RRCKxqI6UwQEMgmcUw/eea4e6a4774c476c108cb32c5cd05856/6.png)\n\n次に、Webhook settingsのタブへ移動し、「Triggers」の設定を修正します。\nNetlify Webhook templateのデフォルト設定だと、master環境のContentのいずれかが公開・非公開になったときにNetlifyのビルドが実行されてしまいます。\n\n今回は、`blog`というContentIDのものが公開・非公開にされたときのみに設定したいので、「Filters」の設定を次のように追加しておきます。\n\n![7](//images.ctfassets.net/xisblufoxlb6/2qc5GV1NgMQAOqUQGwYaM/d1b53a0cd231ad6f4dcfdcfa61130475/7.png)\n\nここまでで設定は終わりです。\n\n実際に`blog`Contentで記事を書いて、公開してみましょう。\n\n![8](//images.ctfassets.net/xisblufoxlb6/6UNcGMUVvauGaoe6KwsS26/20af887f9f76daf8f86abc2a2bb25755/8.png)\n\nContentをPublishした後、Netlifyの管理画面の「Overview」にて、次のようにビルドが走るのが確認できるかと思います。\n\n![9](//images.ctfassets.net/xisblufoxlb6/32iy8P9RJY2sAwAQAwysGm/f527d58dc4ba1bef10a1d18a9584f91e/9.png)\n\n## [宣伝] ゼロからはじめるNetlifyについて\n\n2018年10月8日(月)に開催される技術書典5という技術同人誌即売会イベントにて、「ザ・シメサバズ」として『ゼロからはじめるNetlify』という本を共著で執筆しています。\n\nNetlifyは、主軸となるウェブサイトホスティング機能以外にも様々な機能があり、幅広い層のウェブエンジニアにおすすめできるサービスです。(冒頭でも書きましたが、このブログもNetlifyで運用しています。)\n\nそんなNetlifyの豊富な機能について、サンプルや用途なども交えながら幅広く解説している本になります。\n\n![ogp](//images.ctfassets.net/xisblufoxlb6/3xce6hBY9iIsYcaAi0IOK6/25248774c560ed26ef39853aaf1bf1c4/ogp.png)\n\nぜひお手にとっていただけたらと思います！\n\n以上宣伝でした。\n\n参考ページ\n\n- [Building a portfolio site with Contentful, Next.js and Netlify](https://www.contentful.com/blog/2018/05/09/building-portfolio-website-contentful-nextjs-netlify/)\n- [Webhooks | Netlify](https://www.netlify.com/docs/webhooks/#outgoing-webhooks-and-notifications)"}}],tag:{id:y,slug:g,name:b}}],error:null,state:{auth:!1},serverRendered:!0}}("Link","xisblufoxlb6","master","Environment","ja-JP","Space","Entry","ContentType",{},"30ZYZw8wla4MkaW6yKo6WQ","2018-08-04T03:08:47.389Z",0,0,"Netlify","netlify","2018-06-09T13:08:23.303Z")</script><script src="/nuxtjs-on-github-pages/_nuxt/1d77e36bfaf4096e9780.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/b393d0689b9c4ca582b8.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/e2933058242d1d7a0ae8.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/f8599319a527aafa5ebe.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/c38fbb699c8ff3f12853.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/e57654431899a8469e5c.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/3f4eac2dce17f6d01105.js" defer></script><script src="/nuxtjs-on-github-pages/_nuxt/59b2d8ea80011bfd3679.js" defer></script>
  </body>
</html>
