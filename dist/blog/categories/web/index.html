<!doctype html>
<html data-n-head-ssr lang="ja" data-n-head="lang">
  <head>
    <title data-n-head="true">Web | hyme</title><meta data-n-head="true" name="fragment" content="!"><meta data-n-head="true" data-hid="charset" charset="utf-8"><meta data-n-head="true" data-hid="viewport" name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta data-n-head="true" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="true" data-hid="apple-mobile-web-app-title" name="apple-mobile-web-app-title" content="hyme"><meta data-n-head="true" data-hid="author" name="author" content="hyme"><meta data-n-head="true" data-hid="description" name="description" content="Webエンジニアの自己紹介サイトです。"><meta data-n-head="true" data-hid="og:type" name="og:type" property="og:type" content="website"><meta data-n-head="true" data-hid="og:title" name="og:title" property="og:title" content="hyme"><meta data-n-head="true" data-hid="og:site_name" name="og:site_name" property="og:site_name" content="hyme"><meta data-n-head="true" data-hid="og:description" name="og:description" property="og:description" content="Webエンジニアの自己紹介サイトです。"><meta data-n-head="true" data-hid="twitter:card" name="twitter:card" property="twitter:card" content="summary_large_image"><meta data-n-head="true" data-hid="twitter:site" name="twitter:site" property="twitter:site" content="@_hyme_"><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="true" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/yakuhanjp@3.0.0/dist/css/yakuhanjp.min.css"><link data-n-head="true" rel="manifest" href="/_nuxt/manifest.b88ae3c8.json"><script data-n-head="true" src="//www.googletagmanager.com/gtm.js?id=GTM-N72GKLM&l=dataLayer" async></script><link rel="preload" href="/_nuxt/816590f074b8018aab0e.js" as="script"><link rel="preload" href="/_nuxt/01f90eaae5a1fd0509cf.js" as="script"><link rel="preload" href="/_nuxt/82eb78a79e5b9bfcc303.css" as="style"><link rel="preload" href="/_nuxt/be963e302bfc4aab7a60.js" as="script"><link rel="preload" href="/_nuxt/c1927f61133b46d936f2.css" as="style"><link rel="preload" href="/_nuxt/8b5c4e96cf942127382c.js" as="script"><link rel="preload" href="/_nuxt/ba838dd99d16071c52e0.css" as="style"><link rel="preload" href="/_nuxt/7e820b28996958cb2cba.js" as="script"><link rel="stylesheet" href="/_nuxt/82eb78a79e5b9bfcc303.css"><link rel="stylesheet" href="/_nuxt/c1927f61133b46d936f2.css"><link rel="stylesheet" href="/_nuxt/ba838dd99d16071c52e0.css">
    <script>window.prerenderReady=!1</script>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><main class="blog" data-v-406c1e86><header data-v-75930c71 data-v-406c1e86><div class="logo" data-v-75930c71><a href="/" class="logo__link nuxt-link-active" data-v-75930c71>hyme</a></div><div class="lead" data-v-75930c71>ちょっとなにかある。</div></header><div class="title-box" data-v-406c1e86><h1 class="title" data-v-406c1e86>Web</h1></div><div class="content" data-v-af77dd82 data-v-406c1e86><ul class="posts" data-v-af77dd82><li class="post-item" data-v-cc1e1478 data-v-af77dd82><a href="/blog/posts/effective-public-flow/" data-v-cc1e1478><div class="info" data-v-cc1e1478><span class="info__category" data-v-cc1e1478>Web</span><time class="info__created-at" data-v-cc1e1478>2018.08.04</time></div><p class="title" data-v-cc1e1478>Netlify Build hooks + Contentful Webhookで記事公開フローを効率化する</p></a></li><li class="post-item" data-v-cc1e1478 data-v-af77dd82><a href="/blog/posts/id-and-class-selectors-definition/" data-v-cc1e1478><div class="info" data-v-cc1e1478><span class="info__category" data-v-cc1e1478>Web</span><time class="info__created-at" data-v-cc1e1478>2018.06.09</time></div><p class="title" data-v-cc1e1478>id/classセレクタを属性セレクタ形式で指定する</p></a></li><li class="post-item" data-v-cc1e1478 data-v-af77dd82><a href="/blog/posts/smart-custom-field/" data-v-cc1e1478><div class="info" data-v-cc1e1478><span class="info__category" data-v-cc1e1478>Web</span><time class="info__created-at" data-v-cc1e1478>2018.06.09</time></div><p class="title" data-v-cc1e1478>Smart Custom Fieldを使ってカスタムフィールドを追加する</p></a></li></ul></div></main></div></div><script>window.__NUXT__=function(e,n,t,s,i,a,o,l,d,p,y,c,f,r,g,m,u,b,h,T,k,C,w,S){return d.sys={space:{sys:{type:e,linkType:t,id:a}},id:g,type:l,createdAt:"2018-06-09T13:05:20.243Z",updatedAt:"2018-06-09T13:05:58.402Z",environment:{sys:{id:s,type:e,linkType:i}},revision:2,contentType:{sys:{type:e,linkType:o,id:"category"}},locale:n},d.fields={name:"Web",slug:"web"},{layout:"default",data:[{posts:[{sys:{space:{sys:{type:e,linkType:t,id:a}},id:"2jOwxadZosK0aWUW6e2E4o",type:l,createdAt:"2018-08-04T03:11:45.178Z",updatedAt:"2018-10-06T19:41:25.816Z",environment:{sys:{id:s,type:e,linkType:i}},revision:4,contentType:{sys:{type:e,linkType:o,id:c}},locale:n},fields:{title:"Netlify Build hooks + Contentful Webhookで記事公開フローを効率化する",slug:"effective-public-flow",category:d,tag:[{sys:{space:{sys:{type:e,linkType:t,id:a}},id:"30ZYZw8wla4MkaW6yKo6WQ",type:l,createdAt:T,updatedAt:T,environment:{sys:{id:s,type:e,linkType:i}},revision:1,contentType:{sys:{type:e,linkType:o,id:y}},locale:n},fields:{name:"Netlify",slug:"netlify",category:d}},{sys:{space:{sys:{type:e,linkType:t,id:a}},id:"2vNVGoPyswIoyQImmqO2We",type:l,createdAt:u,updatedAt:u,environment:{sys:{id:s,type:e,linkType:i}},revision:1,contentType:{sys:{type:e,linkType:o,id:y}},locale:n},fields:{name:"Contentful",slug:"contentful",category:d}}],description:"ウェブサイトホスティングサービスのNetlifyのBuild hooksと、Headless CMSであるContentfulのWebhookを用いて、このサイトで実際に使っている自動記事公開環境の作成方法について説明します。",thumbnail:{sys:{space:{sys:{type:e,linkType:t,id:a}},id:"nAh3jYSKBwSAOCGsKy6GI",type:f,createdAt:"2018-10-06T17:48:04.050Z",updatedAt:"2018-10-06T19:40:05.744Z",environment:{sys:{id:s,type:e,linkType:i}},revision:3,locale:n},fields:{title:"ogp",file:{url:"//images.ctfassets.net/xisblufoxlb6/nAh3jYSKBwSAOCGsKy6GI/869e027a003a998b9daea5acb1eff4d0/ogp1.png",details:{size:48345,image:{width:1200,height:630}},fileName:"ogp1.png",contentType:r}}},body:"このサイトは、Contentfulを使って記事の配信、Netlifyでウェブサイトのホスティングを行っており、記事を公開するまでのフローは次のようになっています。\n\n1. 記事を書く\n2. Contentfulの管理画面に入力\n3. 「Publish」ボタンを押して公開(ここまでで筆者の作業は終了)\n4. Netlifyのビルドが実行される\n5. サイトに公開される\n\n上記のように、記事を書く場合はWordPressや通常のブログサイトと同じようなフローで記事を公開できるフローを作っています。\n今回は、この4~6の、「Publishしたら勝手にNetlifyのデプロイを実行する」設定方法について触れようと思います。\n\n## 概要\n\n- NetlifyのContinuous Deployment機能には、Build hooks用のAPIを追加することができる\n- Contentfulには、Content公開時などにWebhookを設定できる\n\nこの両者の機能を使って、前述の4~6のフローを実現しています。\n\n## 設定方法\n\nでは、実際に設定していきます。(NetlifyのDeploy Settingまでの設定と、Contentfulの設定が終わってる前提です。)\n\n### NetlifyのBuild hook用のAPIの作成\n\nまずはNetlifyのBuild hook用のAPIを作成します。  \n用途がわかるような名称(今回は「Webhook for Contentful」としてます)と、ビルドを実行するブランチを指定します。\n\n![1](//images.ctfassets.net/xisblufoxlb6/h0AaILJVsc4w6mK84SEQa/a7c448e60b979fc0ae55478299e3abce/1.png)\n\n「Save」すればAPIのURLが発行されます。\n\n![2](//images.ctfassets.net/xisblufoxlb6/6kMqWKFpm0EiCKKqUgMgaU/5ad76e8716e148bf102fa521b79e3a60/2.png)\n\n### ContentfulのWebhookの設定\n\n次は、 Contentfulの管理画面でWebhookの設定を行います。\n\n管理画面メニューの「Space settings」→「Webhooks」を選択します。  \n次に、右下の「Webhook templates」から「Netlify」を選びます。\n\n![4](//images.ctfassets.net/xisblufoxlb6/2zr7Ez1nqQ4sIas8IosywO/1ac7884bedf3e92bd735f04ec020984b/4.png)\n\nそして、先程Netlify側で設定したBuild hook用のURLを「Netlify build hook URL」に設定します。\n\n![5](//images.ctfassets.net/xisblufoxlb6/fd1KgedLq0S88MWkYKIcm/fd3a24a78b59b612f5073cfda5cf6ab7/5.png)\n\n最後に「Create webhook」をクリックすれば設定完了です。\n以下のようなダイアログと同時に、Netlify用のWebhookが設定された画面に遷移します。\n\n![6](//images.ctfassets.net/xisblufoxlb6/5CX8RRCKxqI6UwQEMgmcUw/eea4e6a4774c476c108cb32c5cd05856/6.png)\n\n次に、Webhook settingsのタブへ移動し、「Triggers」の設定を修正します。\nNetlify Webhook templateのデフォルト設定だと、master環境のContentのいずれかが公開・非公開になったときにNetlifyのビルドが実行されてしまいます。\n\n今回は、`blog`というContentIDのものが公開・非公開にされたときのみに設定したいので、「Filters」の設定を次のように追加しておきます。\n\n![7](//images.ctfassets.net/xisblufoxlb6/2qc5GV1NgMQAOqUQGwYaM/d1b53a0cd231ad6f4dcfdcfa61130475/7.png)\n\nここまでで設定は終わりです。\n\n実際に`blog`Contentで記事を書いて、公開してみましょう。\n\n![8](//images.ctfassets.net/xisblufoxlb6/6UNcGMUVvauGaoe6KwsS26/20af887f9f76daf8f86abc2a2bb25755/8.png)\n\nContentをPublishした後、Netlifyの管理画面の「Overview」にて、次のようにビルドが走るのが確認できるかと思います。\n\n![9](//images.ctfassets.net/xisblufoxlb6/32iy8P9RJY2sAwAQAwysGm/f527d58dc4ba1bef10a1d18a9584f91e/9.png)\n\n## [宣伝] ゼロからはじめるNetlifyについて\n\n2018年10月8日(月)に開催される技術書典5という技術同人誌即売会イベントにて、「ザ・シメサバズ」として『ゼロからはじめるNetlify』という本を共著で執筆しています。\n\nNetlifyは、主軸となるウェブサイトホスティング機能以外にも様々な機能があり、幅広い層のウェブエンジニアにおすすめできるサービスです。(冒頭でも書きましたが、このブログもNetlifyで運用しています。)\n\nそんなNetlifyの豊富な機能について、サンプルや用途なども交えながら幅広く解説している本になります。\n\n![ogp](//images.ctfassets.net/xisblufoxlb6/3xce6hBY9iIsYcaAi0IOK6/25248774c560ed26ef39853aaf1bf1c4/ogp.png)\n\nぜひお手にとっていただけたらと思います！\n\n以上宣伝でした。\n\n参考ページ\n\n- [Building a portfolio site with Contentful, Next.js and Netlify](https://www.contentful.com/blog/2018/05/09/building-portfolio-website-contentful-nextjs-netlify/)\n- [Webhooks | Netlify](https://www.netlify.com/docs/webhooks/#outgoing-webhooks-and-notifications)"}},{sys:{space:{sys:{type:e,linkType:t,id:a}},id:"4RRGpMqYzYSO0G6c4u8wii",type:l,createdAt:"2018-06-09T14:26:15.363Z",updatedAt:"2018-06-09T14:44:26.994Z",environment:{sys:{id:s,type:e,linkType:i}},revision:3,contentType:{sys:{type:e,linkType:o,id:c}},locale:n},fields:{title:"id/classセレクタを属性セレクタ形式で指定する",slug:"id-and-class-selectors-definition",category:d,tag:[{sys:{space:{sys:{type:e,linkType:t,id:a}},id:"63VkXcJXHyKOgU6sO2wOqW",type:l,createdAt:k,updatedAt:k,environment:{sys:{id:s,type:e,linkType:i}},revision:1,contentType:{sys:{type:e,linkType:o,id:y}},locale:n},fields:{name:"CSS",slug:"css",category:d}}],description:'id/classセレクタの#id-name / .class-nameは、[id="id-name"] / [class="class-name"] と属性セレクタとして記述・指定することができます。',thumbnail:{sys:{space:{sys:{type:e,linkType:t,id:a}},id:"5vsvsL2TzGam8OUai4KYGO",type:f,createdAt:C,updatedAt:C,environment:{sys:{id:s,type:e,linkType:i}},revision:1,locale:n},fields:{title:"image",file:{url:"//images.ctfassets.net/xisblufoxlb6/5vsvsL2TzGam8OUai4KYGO/d532443cf2d2dc505d1a6f134db5a1e5/image.png",details:{size:512571,image:{width:1334,height:1070}},fileName:"image.png",contentType:r}}},body:'メモ書き。\n\nid/classセレクタの`#id-name` / `.class-name`は、`[id="id-name"]` / `[class="class-name"]` と属性セレクタとして記述・指定することができます。\n\nこのように書くと、id/classセレクタではなく属性セレクタとして扱われます。\nしたがって、classに関しては詳細度は変わりませんが、**id指定を属性セレクタで記述することで詳細度を下げることができます。**\n\n\n↓.class-name/\\[class="class-name"\\]\n![image](//images.ctfassets.net/xisblufoxlb6/5tanmIXVWE0KoU0SAkGyeU/1dde2ddc33f60653721a08a1dc4ddf5d/image.png)\n\n↓#id-name/\\[id="id-name"\\]\n![image](//images.ctfassets.net/xisblufoxlb6/5vsvsL2TzGam8OUai4KYGO/d532443cf2d2dc505d1a6f134db5a1e5/image.png)\n\n\n[Specificity Calculator](http://specificity.keegan.st/)で詳細度を見てみました。\n\n昨今のBEMやらOOCSSの流れを鑑みると使うケースはなかなかないかもしれませんが、アイデアの一つとして知っておきたいですね。\n\n\n## 参考文献\n\n- [cssの詳細度・優先度を理解し使いこなすために必要なたった1つのこと](http://qiita.com/nekoneko-wanwan/items/69ccf2c6cecda0726ee7)\n'}},{sys:{space:{sys:{type:e,linkType:t,id:a}},id:"6id0y41YZi4uUw8W2W6iqE",type:l,createdAt:"2018-06-09T13:20:14.372Z",updatedAt:"2019-02-08T09:07:08.140Z",environment:{sys:{id:s,type:e,linkType:i}},revision:5,contentType:{sys:{type:e,linkType:o,id:c}},locale:n},fields:{title:"Smart Custom Fieldを使ってカスタムフィールドを追加する",slug:"smart-custom-field",category:d,tag:[{sys:{space:{sys:{type:e,linkType:t,id:a}},id:"3s6v1pLEY8eMEM6yosqKwA",type:l,createdAt:w,updatedAt:w,environment:{sys:{id:s,type:e,linkType:i}},revision:1,contentType:{sys:{type:e,linkType:o,id:y}},locale:n},fields:{name:"WordPress",slug:"wordpress",category:d}}],description:"WordPressの案件で必ずつきまとうのが、カスタムフィールド管理について。今回は、カスタムフィールドの設定をコードとして保存できるSmart Custom Field(SCF)についてと、カスタムフィールドを追加する手順についての記事です。",thumbnail:{sys:{space:{sys:{type:e,linkType:t,id:a}},id:"4dT569vDufOkU3uGQSoVCH",type:f,createdAt:b,updatedAt:b,environment:{sys:{id:s,type:e,linkType:i}},revision:1,locale:n},fields:{title:"scf",file:{url:"//images.ctfassets.net/xisblufoxlb6/4dT569vDufOkU3uGQSoVCH/49e49bdff3326eaed486e1d813e7d0ac/banner-1544x500.png",details:{size:129696,image:{width:1544,height:500}},fileName:"banner-1544x500.png",contentType:r}}},body:"WordPressの案件で必ずつきまとうのが、カスタムフィールド管理について。\n今回は、カスタムフィールドの設定をコードとして保存できるSmart Custom Field(SCF)についてと、カスタムフィールドを追加する手順についての記事です。\n\n## Smart Custom Fieldについて\n\nカスタムフィールドをコードベースで設定できる WordPressプラグインです。\nDBに保存する必要があるカスタムフィールドの設定項目ですが、このプラグインを使うことで `.php` ファイルで管理することができます。\n基本的なループやラジオボタンなどは対応しています。(関連付けなどはなかったかも)\n開発者が日本の方だそう。\n\n## Smart Custom Fieldを使うメリット\n\n\n### Git管理ができる\n\nこれに尽きると思います。\nまた、バージョン管理せずに他のプラグインのように管理画面から設定することも可能です。\nただし、そちらで設定した項目はDBに保存されるため、バージョン管理の項目から外れてしまいます。\n\n\n### ループに対応\n\nグループごとにループの設定ができます。\nまた、デフォルトではないループで設定した値をグルーピングして取得するための機能(`SCF::get('group-name')`)が用意されています。\n\n\n今回は、ラーメンを投稿するブログサイトを作る場合に、以下のような項目を入力してもらう想定でカスタムフィールドを指定しましょう。\n\n\n\n## Smart Custom Fieldをインストール&有効化\n\n管理画面などからプラグインを検索してインストールしましょう。\n\nターミナルからなら、WP-CLIでインストールできると楽ですね。\n\n`wp plugin install custom-post-type-permalinks --activate`\n\n\n\n## 実際にコードを書く\n\n今回は、`post` 投稿タイプにのみ表示されるカスタムフィールドを作成します。\n\n\n### function.phpにカスタムフィールドの項目を追加する関数を書く\n\n```php\nfunction add_shop_info_fields($settings, $post_type, $post_id, $meta_type) {\n  // post以外の投稿タイプなら特に何もしない\n  if($post_type != 'post') return $settings;\n\n  // 引数: (設定名スラッグ, ラベル名)\n  $Setting = SCF::add_setting('shop-info', '店舗情報');\n\n  $items = array(\n    array(\n      'name'  => 'name',\n      'label' => '店舗名',\n      'type'  => 'text'\n    ),\n    array(\n      'name' => 'place',\n      'label' => '住所',\n      'type' => 'textarea',\n    ),\n    array(\n      'name' => 'description',\n      'label' => '店舗の説明',\n      'type' => 'textarea',\n    ),\n    array(\n      'name' => 'image',\n      'label' => '店舗の画像',\n      'type' => 'image',\n    ),\n  );\n\n  // 引数: (グループ名, ループの可否, 項目の配列)\n  $Setting->add_group('group-shop-info', true, $items);\n\n  // 今あるカスタムフィールドの設定に$Settingを追加\n  array_push($settings, $Setting);\n\n  return $settings;\n}\n\n// smart-cf-register-fieldsにフック\nadd_filter('smart-cf-register-fields', 'add_shop_info_fields', 10, 4);\n```\n\nこれを保存して新規投稿画面に移動すると、下の方にカスタムフィールドが表示されていると思います。\n\n![画像]\n\n\n### 該当ページに設定した情報を表示させる\n\n基本的には、メインループ内で `SCF::get('meta_data')` で取得することができます。\n\n```\n<?php\n  $info_array = SCF::get('group-shop-info');\n  foreach($info_array as $info):\n?>\n  <?php if(isset($info['name']): ?>\n    <p><?=$info['name'] ?></p>\n  <?php endif; ?>\n<?php endforeach; ?>\n```\n\n\n### 該当ページ以外でカスタムフィールドの値を取得する場合\n\nたとえば、トップページに店舗名の一覧だけ表示したいという場合には、カスタムフィールドを設定したページのID(固定ページなら固定ページのID、投稿なら記事IDなど)を設定することで取得することができます。\n\n```\n<?php\n// front-page.phpなど\nSCF::get('group-shop-info', get_page_by_path('shop'));\n```\n\n\n\n## SCFを使う時に覚えておくこと\n\n\n### ループの有無で取得方法が変わる\n\n\n### 画像/ファイル/ページなどはすべてIDが保存される\n\nWordPressにアップロードした画像などのファイルや、関連記事などで選択した記事をSCFで設定した場合、すべてIDとして保存される仕組みになっています。\n\n[言及してたURL]()\n\nしたがって、ファイルや記事を取得したい場合は、 `wp_get_attachment()` や `get_the_post()` などにIDを渡して取得する必要があります。\n統一されているのでわかりやすいです。\n\n\n\n## カスタムフィールドの投稿タイプの種類\n\n基本的にWordPressのデフォルトで指定できるものには対応しています。\n\n\n参考ページ\n\n- https://github.com/inc2734/smart-custom-fields/\n- https://gist.github.com/inc2734/9f6d65c7473d060d0fd6#file-gistfile1-php-L4\n- https://ja.wordpress.org/plugins/smart-custom-fields/\n- [Smart Custom Fields でカスタムフィールドの定義を Git で管理できるようになりました！ &#8211; モンキーレンチ](https://2inc.org/blog/2015/03/12/4670/)\n- [SmartCustomFieldsのコードでの定義についてのまとめ](http://qiita.com/yousan/items/7cbd56308ecc0e2bb263)\n"}}],category:{id:g,slug:"web",name:"Web"}}],error:null,state:{auth:!1},serverRendered:!0}}("Link","ja-JP","Space","master","Environment","xisblufoxlb6","ContentType","Entry",{},0,"tag","blog","Asset","image/png","1RHECfKcNO0OaW280uCOCY",0,"2018-06-09T13:08:23.303Z","2019-02-08T09:06:56.352Z",0,"2018-08-04T03:08:47.389Z","2018-06-09T14:24:05.221Z","2018-06-09T14:36:10.254Z","2018-06-09T13:07:13.090Z")</script><script src="/_nuxt/816590f074b8018aab0e.js" defer></script><script src="/_nuxt/7e820b28996958cb2cba.js" defer></script><script src="/_nuxt/01f90eaae5a1fd0509cf.js" defer></script><script src="/_nuxt/be963e302bfc4aab7a60.js" defer></script><script src="/_nuxt/8b5c4e96cf942127382c.js" defer></script>
  </body>
</html>
